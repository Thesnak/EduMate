<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduMate</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
        }

        .slogan {
            color: #4CAF50;
            font-size: 1.5em;
            margin: 10px 0 20px;
            font-weight: 300;
            text-align: center;
        }

        .header {
            background: #1a1a1a;
            padding: 15px 20px;
            border-bottom: 1px solid #2a2a2a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            color: #fff;
        }

        .author-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #e0e0e0;
        }

        .author-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .author-name {
            font-weight: 500;
            color: #fff;
        }

        .author-role {
            font-size: 14px;
            color: #aaa;
        }

        .linkedin-button {
            padding: 6px 12px;
            background: #0077b5;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
            text-decoration: none;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .linkedin-button:hover {
            background: #005885;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .header-buttons button {
            padding: 8px 16px;
            background: #3ea6ff;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .header-buttons button:hover {
            background: #2d8fd8;
        }

        .header-buttons button.secondary {
            background: #2a2a2a;
        }

        .header-buttons button.secondary:hover {
            background: #3a3a3a;
        }

        /* Welcome Page Styles */
        .welcome-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 70px);
            text-align: center;
            padding: 40px;
        }

        .welcome-page.active {
            display: flex;
        }

        .welcome-page.hidden {
            display: none;
        }

        .welcome-logo {
            font-size: 80px;
            margin-bottom: 10px;
        }

        .welcome-page h1 {
            font-size: 48px;
            color: #fff;
            margin-bottom: 10px;
        }

        .welcome-page p {
            font-size: 18px;
            color: #888;
            margin-bottom: 20px;
            max-width: 600px;
        }

        .welcome-actions {
            display: flex;
            gap: 20px;
        }

        .welcome-actions button {
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .welcome-actions button.primary {
            background: #3ea6ff;
            color: white;
        }

        .welcome-actions button.primary:hover {
            background: #2d8fd8;
            transform: translateY(-2px);
        }

        .welcome-actions button.secondary {
            background: #2a2a2a;
            color: white;
        }

        .welcome-actions button.secondary:hover {
            background: #3a3a3a;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 60px;
            max-width: 900px;
        }

        .feature-card {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            transition: transform 0.2s, background-color 0.2s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            background: #252525;
        }

        .feature-card .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .feature-card h3 {
            font-size: 18px;
            color: #fff;
            margin-bottom: 10px;
        }

        .feature-card p {
            font-size: 14px;
            color: #888;
            margin: 0;
        }

        /* About Page Styles */
        .about-page {
            display: none;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .about-page.active {
            display: block;
        }

        .about-page h1 {
            font-size: 36px;
            color: #fff;
            margin-bottom: 30px;
        }

        .about-page h2 {
            font-size: 24px;
            color: #3ea6ff;
            margin-top: 40px;
            margin-bottom: 20px;
        }

        .about-page p {
            font-size: 16px;
            color: #b0b0b0;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .about-page .version {
            display: inline-block;
            background: #2a2a2a;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            color: #3ea6ff;
            margin-bottom: 20px;
        }

        .about-page ul {
            list-style: none;
            padding: 0;
        }

        .about-page ul li {
            padding: 10px 0;
            color: #b0b0b0;
            font-size: 16px;
        }

        .about-page ul li:before {
            content: "‚úì ";
            color: #3ea6ff;
            font-weight: bold;
            margin-right: 10px;
        }

        /* Books Library Styles */
        .books-library {
            display: none;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .books-library.active {
            display: block;
        }

        .books-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .books-header h2 {
            font-size: 28px;
            color: #fff;
        }

        .books-header button {
            padding: 10px 20px;
            background: #3ea6ff;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .books-header button:hover {
            background: #2d8fd8;
        }

        .bookshelf {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 30px;
            padding: 20px 0;
        }

        .book {
            cursor: pointer;
            transition: transform 0.2s;
            text-align: center;
        }

        .book:hover {
            transform: translateY(-10px);
        }

        .book-cover {
            width: 100%;
            height: 260px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
            cursor: pointer;
            background-size: cover;
            background-position: center;
            overflow: hidden;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .book-cover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
        }

        .book-cover.custom-color-1 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .book-cover.custom-color-2 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .book-cover.custom-color-3 {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .book-cover.custom-color-4 {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .book-cover.custom-color-5 {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        .book-cover .book-icon {
            font-size: 60px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .book-cover .book-title {
            font-size: 16px;
            font-weight: 600;
            color: white;
            text-align: center;
            line-height: 1.3;
            position: relative;
            z-index: 1;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .book-name {
            margin-top: 10px;
            font-size: 14px;
            color: #b0b0b0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .book-actions {
            margin-top: 10px;
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .book-actions button {
            padding: 5px 10px;
            background: #2a2a2a;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .book-actions button:hover {
            background: #3a3a3a;
        }

        .book-actions button.delete {
            background: #d32f2f;
        }

        .book-actions button.delete:hover {
            background: #b71c1c;
        }

        .empty-bookshelf {
            text-align: center;
            padding: 100px 20px;
            color: #666;
        }

        .empty-bookshelf svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-bookshelf h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        /* Dashboard Styles */
        .dashboard {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .dashboard h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #fff;
        }

        .library-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .library-actions button {
            padding: 10px 20px;
            background: #3ea6ff;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .library-actions button:hover {
            background: #2d8fd8;
        }

        .specializations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .specialization-card {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .specialization-card:hover {
            border-color: #3ea6ff;
            transform: translateY(-2px);
        }

        .specialization-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #fff;
        }

        .specialization-card .course-count {
            color: #888;
            font-size: 14px;
        }

        .specialization-card .actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .specialization-card .actions button {
            padding: 5px 10px;
            background: #2a2a2a;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .specialization-card .actions button:hover {
            background: #3a3a3a;
        }

        .specialization-card .actions button.view {
            background: #3ea6ff;
        }

        .specialization-card .actions button.view:hover {
            background: #2d8fd8;
        }

        .specialization-card .actions button.delete {
            background: #d32f2f;
        }

        .specialization-card .actions button.delete:hover {
            background: #b71c1c;
        }

        .courses-section h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #fff;
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .course-card {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .course-card:hover {
            border-color: #3ea6ff;
        }

        .course-card h4 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #fff;
        }

        .course-card .path {
            color: #666;
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-bottom: 10px;
        }

        .course-card .actions {
            display: flex;
            gap: 8px;
        }

        .course-card .actions button {
            padding: 5px 10px;
            background: #2a2a2a;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .course-card .actions button:hover {
            background: #3a3a3a;
        }

        .course-card .actions button.delete {
            background: #d32f2f;
        }

        .course-card .actions button.delete:hover {
            background: #b71c1c;
        }

        /* Specialization Viewer Styles */
        .specialization-viewer {
            display: none;
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .specialization-viewer.active {
            display: block;
        }

        .spec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .spec-header h2 {
            font-size: 28px;
            color: #fff;
        }

        .spec-header .actions {
            display: flex;
            gap: 10px;
        }

        .spec-header button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .spec-header button.primary {
            background: #3ea6ff;
            color: white;
        }

        .spec-header button.primary:hover {
            background: #2d8fd8;
        }

        .spec-header button.secondary {
            background: #2a2a2a;
            color: white;
        }

        .spec-header button.secondary:hover {
            background: #3a3a3a;
        }

        .roadmap-container {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 30px;
            position: relative;
        }

        .roadmap-title {
            font-size: 18px;
            margin-bottom: 30px;
            color: #b0b0b0;
            text-align: center;
        }

        .roadmap {
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }

        .roadmap::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #3ea6ff, #2d8fd8);
            transform: translateX(-50%);
        }

        .roadmap-item {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        .roadmap-item .course-number {
            width: 40px;
            height: 40px;
            background: #3ea6ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            z-index: 2;
            flex-shrink: 0;
        }

        .roadmap-item .course-content {
            flex: 1;
            background: #252525;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .roadmap-item .course-content:hover {
            border-color: #3ea6ff;
            transform: translateX(5px);
        }

        .roadmap-item .course-content h3 {
            font-size: 18px;
            color: #fff;
            margin-bottom: 8px;
        }

        .roadmap-item .course-content .path {
            font-size: 13px;
            color: #888;
            margin-bottom: 12px;
        }

        .roadmap-item .course-content .course-actions {
            display: flex;
            gap: 10px;
        }

        .roadmap-item .course-content .course-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        .roadmap-item .course-content .course-actions button.start {
            background: #3ea6ff;
            color: white;
        }

        .roadmap-item .course-content .course-actions button.start:hover {
            background: #2d8fd8;
        }

        .roadmap-item .course-content .course-actions button.edit {
            background: #2a2a2a;
            color: white;
        }

        .roadmap-item .course-content .course-actions button.edit:hover {
            background: #3a3a3a;
        }

        .roadmap-item .course-content .course-actions button.remove {
            background: #d32f2f;
            color: white;
        }

        .roadmap-item .course-content .course-actions button.remove:hover {
            background: #b71c1c;
        }

        .roadmap-item .order-controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-left: auto;
        }

        .roadmap-item .order-controls button {
            width: 30px;
            height: 30px;
            background: #2a2a2a;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .roadmap-item .order-controls button:hover {
            background: #3ea6ff;
        }

        .roadmap-item .order-controls button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .roadmap-item .order-controls button:disabled:hover {
            background: #2a2a2a;
        }

        .empty-roadmap {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-roadmap svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid #2a2a2a;
        }

        .modal-content h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #fff;
        }

        .modal-content input,
        .modal-content select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            color: #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
        }

        .modal-content .buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-content button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .modal-content button.primary {
            background: #3ea6ff;
            color: white;
        }

        .modal-content button.primary:hover {
            background: #2d8fd8;
        }

        .modal-content button.secondary {
            background: #2a2a2a;
            color: white;
        }

        .modal-content button.secondary:hover {
            background: #3a3a3a;
        }

        /* Player View Styles */
        .player-view {
            display: none;
            height: calc(100vh - 70px);
        }

        .player-view.active {
            display: flex;
        }

        .main-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .sidebar {
            width: 350px;
            background: #1a1a1a;
            border-right: 1px solid #2a2a2a;
            overflow-y: auto;
            padding: 15px;
        }

        .course-item {
            margin-bottom: 20px;
        }

        .course-header {
            font-size: 16px;
            font-weight: 600;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 4px;
            margin-bottom: 10px;
            color: #fff;
        }

        .module-item {
            margin-bottom: 8px;
            margin-left: 10px;
        }

        .module-header {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #252525;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .module-header:hover {
            background: #2d2d2d;
        }

        .module-header svg {
            width: 16px;
            height: 16px;
            margin-right: 8px;
        }

        .module-content {
            margin-left: 20px;
            margin-top: 5px;
            display: none;
        }

        .module-content.expanded {
            display: block;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin: 3px 0;
            background: #1f1f1f;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: #2a2a2a;
        }

        .file-item.active {
            background: #3ea6ff;
            color: white;
        }

        .file-item svg {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .file-item .checkbox {
            margin-left: auto;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .player-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0f0f0f;
        }

        .player-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #000;
            position: relative;
            overflow: hidden;
        }

        .placeholder {
            text-align: center;
            color: #666;
        }

        .placeholder svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        video {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
        }

        #pdfViewer {
            width: 100%;
            height: 100%;
            border: none;
        }

        .subtitle-overlay {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 18px;
            max-width: 80%;
            text-align: center;
        }

        .subtitle-text[dir="rtl"] {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 20px;
            line-height: 1.5;
            text-align: right;
            max-width: 80%;
            text-align: center;
            line-height: 1.4;
            display: none;
        }

        .subtitle-overlay.visible {
            display: block;
        }

        .video-controls {
            background: #1a1a1a;
            padding: 15px 20px;
            border-top: 1px solid #2a2a2a;
        }

        .current-file-info {
            font-size: 14px;
            margin-bottom: 10px;
            color: #b0b0b0;
        }

        .controls-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 10px;
        }

        .controls-group label {
            font-size: 13px;
            color: #b0b0b0;
        }

        .controls-group select {
            padding: 5px 10px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            color: #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }
.translate-button {
    padding: 6px 12px;
    background: #4caf50;
    border: none;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    margin-left: 10px;
}

.translate-button:hover {
    background: #45a049;
}

.translate-button:disabled {
    background: #666;
    cursor: not-allowed;
}
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #3a3a3a;
            border-radius: 3px;
            cursor: pointer;
            margin-bottom: 10px;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: #3ea6ff;
            border-radius: 3px;
            width: 0%;
        }

        .controls-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .play-button {
            background: #3ea6ff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .play-button:hover {
            background: #2d8fd8;
        }

        .play-button svg {
            width: 20px;
            height: 20px;
            color: white;
        }

        .time-display {
            font-size: 14px;
            color: #b0b0b0;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #3ea6ff;
            font-size: 16px;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìö EduMate</h1>
        <div class="header-buttons">
            <button id="homeBtn" onclick="showWelcome()">Home</button>
            <button id="libraryBtn" onclick="showDashboard()">Courses</button>
            <button id="booksBtn" onclick="showBooks()">Books</button>
            <button id="aboutBtn" onclick="showAbout()">About</button>
            <button id="backBtn" class="secondary" onclick="goBack()" style="display: none;">‚Üê Back</button>
        </div>
    </div>

    <!-- Welcome Page -->
    <div class="welcome-page active" id="welcomePage">
        <div class="welcome-logo">
            <img src="assets/logo.png" alt="EduMate Logo" width="180" height="180">
        </div>
        <h1>Welcome to EduMate</h1>
        <h2 class="slogan">Your Study Mate</h2>
        <p>Your personal learning management system. Organize courses, track progress, and build your knowledge library.</p>
        
        <div class="welcome-actions">
            <button class="primary" onclick="showDashboard()">Get Started</button>
            <button class="secondary" onclick="showAbout()">Learn More</button>
        </div>

        <div class="features-grid">
            <div class="feature-card" onclick="showDashboard()" style="cursor: pointer;">
                <div class="icon">üéì</div>
                <h3>Course Library</h3>
                <p>Organize your courses into specializations and track your learning journey</p>
            </div>
            <div class="feature-card" onclick="showBooks()" style="cursor: pointer;">
                <div class="icon">üìñ</div>
                <h3>Books Collection</h3>
                <p>Build your digital bookshelf with PDFs and organize your reading materials</p>
            </div>
            <div class="feature-card" onclick="showDashboard()" style="cursor: pointer;">
                <div class="icon">üé¨</div>
                <h3>Video Player</h3>
                <p>Watch lectures with subtitle support and adjustable playback speed</p>
            </div>
        </div>
    </div>

    <!-- About Page -->
    <div class="about-page" id="aboutPage">
        <div class="app-logo">
            <img src="assets/logo.png" alt="EduMate Logo" width="160" height="160">
        </div>
        <h1>About EduMate</h1>
        <h2 class="slogan">Your Study Mate</h2>
        <span class="version">Version 1.0.0</span>
        
        <p>EduMate is a comprehensive learning management application designed to help you organize, track, and consume educational content efficiently.</p>
        <div class="author-info">
            <div class="author-details">
                <span class="author-name">Mohamed Mahmoud Ali</span>
                <span class="author-role">Big Data & AI Engineer</span>
            </div>
            <a href="https://linkedin.com/in/mohamed-thesnak" class="linkedin-button" target="_blank">
                <svg height="14" width="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                </svg>
                LinkedIn
            </a>
        </div>
        <h2>Features</h2>
        <ul>
            <li>Course Library Management - Organize courses into specializations</li>
            <li>Visual Roadmap - See your learning path with numbered progression</li>
            <li>Video Player - Play videos with subtitle support and speed control</li>
            <li>PDF Viewer - Read course materials and documents</li>
            <li>Progress Tracking - Mark lectures and materials as complete</li>
            <li>Books Library - Organize PDFs on a beautiful bookshelf</li>
            <li>Dark Theme - Easy on the eyes for long study sessions</li>
        </ul>

        <h2>How to Use</h2>
        <p><strong>Adding Courses:</strong> Click "Courses" ‚Üí "+ Add Course" ‚Üí Browse to your course folder. Optionally assign to a specialization.</p>
        
        <p><strong>Creating Specializations:</strong> Group related courses together (e.g., "Data Science Path"). View as a roadmap and reorder courses.</p>
        
        <p><strong>Adding Books:</strong> Click "Books" ‚Üí "+ Add Book" ‚Üí Browse to your PDF files. They'll appear on your bookshelf with custom covers.</p>
        
        <p><strong>Playing Content:</strong> Click any course or book to open it. Use speed controls (0.25x - 2x) and subtitle selector for videos.</p>

        <h2>Keyboard Shortcuts</h2>
        <ul>
            <li>Space - Play/Pause video</li>
            <li>‚Üê ‚Üí - Seek backward/forward (when video controls focused)</li>
            <li>F - Fullscreen (when video controls focused)</li>
        </ul>

        <h2>Technology Stack</h2>
        <p>Built with Electron, Node.js, and modern web technologies for a native desktop experience.</p>

        <h2>Data Storage</h2>
        <p>All your library data and progress is stored locally on your computer using localStorage. Your data never leaves your machine.</p>
    </div>

    <!-- Books Library -->
    <div class="books-library" id="booksLibrary">
        <div class="books-header">
            <h2>üìñ My Books</h2>
            <div style="display:flex; gap:8px;">
                <button onclick="showAddBookModal()">+ Add Book</button>
                <button class="secondary" onclick="showManageCategoriesModal()">Manage Categories</button>
            </div>
        </div>

        <div class="bookshelf" id="bookshelf">
            <!-- Books will be added here -->
        </div>
    </div>

    <!-- Dashboard View -->
    <div class="dashboard" id="dashboard">
        <h2>My Learning Library</h2>
        
        <div class="library-actions">
            <button onclick="showAddSpecializationModal()">+ Add Specialization</button>
            <button onclick="showAddCourseModal()">+ Add Course</button>
        </div>

        <div id="specializationsSection">
            <h3>Specializations</h3>
            <div class="specializations-grid" id="specializationsGrid">
                <!-- Specialization cards will be added here -->
            </div>
        </div>

        <div class="courses-section">
            <h3>Individual Courses</h3>
            <div class="courses-grid" id="coursesGrid">
                <!-- Course cards will be added here -->
            </div>
        </div>
    </div>

    <!-- Specialization Viewer -->
    <div class="specialization-viewer" id="specializationViewer">
        <div class="spec-header">
            <h2 id="specTitle"></h2>
            <div class="actions">
                <button class="secondary" onclick="editSpecialization()">Edit Name</button>
                <button class="primary" onclick="showAddCourseToSpecModal()">+ Add Course</button>
                <button class="secondary" onclick="startSpecialization()">Start Learning</button>
            </div>
        </div>

        <div class="roadmap-container">
            <p class="roadmap-title">üìö Learning Path Roadmap</p>
            <div class="roadmap" id="roadmap">
                <!-- Roadmap items will be added here -->
            </div>
        </div>
    </div>

    <!-- Player View -->
    <div class="player-view" id="playerView">
        <div class="main-container">
            <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>
            <style>
                .sidebar {
                    width: 300px;
                    min-width: 300px;
                    max-width: 300px;
                    background: #1a1a1a;
                    border-right: 1px solid #2a2a2a;
                    transition: transform 0.3s ease, margin-left 0.3s ease;
                    margin-left: 0;
                    height: 100%;
                    overflow-y: auto;
                }
                
                .sidebar-toggle {
                    position: absolute;
                    left: 300px;
                    top: 10px;
                    z-index: 100;
                    background: #2a2a2a;
                    border: none;
                    color: #fff;
                    padding: 8px;
                    border-radius: 0 4px 4px 0;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    transition: left 0.3s ease;
                }

                .sidebar-toggle:hover {
                    background: #3a3a3a;
                }

                .sidebar-toggle svg {
                    width: 20px;
                    height: 20px;
                }
            </style>

            <div class="sidebar" id="sidebar">
                <div style="text-align: center; color: #666; padding: 40px 20px;">
                    <p>Loading courses...</p>
                </div>
            </div>

            <div class="player-container">
                <div class="player-area" id="playerArea">
                    <div class="placeholder">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <p>Select a video or PDF to start</p>
                    </div>
                    <div class="subtitle-overlay" id="subtitleOverlay"></div>
                </div>

                <div class="video-controls" id="videoControls" style="display: none;">
                    <div class="current-file-info" id="currentFileInfo"></div>
                    <div class="progress-bar" id="progressBar" onclick="seekVideo(event)">
                        <div class="progress-bar-fill" id="progressBarFill"></div>
                    </div>
                    <div class="controls-row">
                        <button class="play-button" id="playButton" onclick="togglePlay()">
                            <svg id="playIcon" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </button>
                        <span class="time-display" id="timeDisplay">0:00 / 0:00</span>
                    </div>
                    <div class="controls-group">
                        <label>Speed:</label>
                        <select id="speedSelect" onchange="changeSpeed()">
                            <option value="0.25">0.25x</option>
                            <option value="0.5">0.5x</option>
                            <option value="0.75">0.75x</option>
                            <option value="1" selected>1x</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x</option>
                            <option value="1.75">1.75x</option>
                            <option value="2">2x</option>
                        </select>
                        
                        <label style="margin-left: 20px;">Subtitles:</label>
                        <select id="subtitleSelect" onchange="changeSubtitle()">
                            <option value="">None</option>
                        </select>
                        <div style="display: inline-block; margin-left: 15px;">
                            <!-- <input type="checkbox" id="autoTranslateCheck" onchange="toggleAutoTranslate()">
                            <label for="autoTranslateCheck">Auto-translate to Arabic</label> -->
  <button class="translate-button" id="translateBtn" onclick="translateSubtitle()" style="display: none;">
        üåê Translate to Arabic
    </button>                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Specialization Modal -->
    <div class="modal" id="addSpecializationModal">
        <div class="modal-content">
            <h3>Add Specialization</h3>
            <input type="text" id="specializationName" placeholder="Specialization Name">
            <div class="buttons">
                <button class="secondary" onclick="closeModal('addSpecializationModal')">Cancel</button>
                <button class="primary" onclick="addSpecialization()">Add</button>
            </div>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div class="modal" id="addCourseModal">
        <div class="modal-content">
            <h3 id="addCourseModalTitle">Add Course</h3>
            <input type="text" id="courseName" placeholder="Course Name">
            <input type="text" id="coursePath" placeholder="Course Path" readonly>
            <button class="secondary" onclick="browseCourseDirectory()" style="width: 100%; margin-bottom: 15px;">Browse Directory</button>
            <select id="courseSpecialization">
                <option value="">No Specialization (Individual Course)</option>
            </select>
            <div class="buttons">
                <button class="secondary" onclick="closeModal('addCourseModal')">Cancel</button>
                <button class="primary" onclick="addCourse()">Add</button>
            </div>
        </div>
    </div>

    <!-- Edit Course Modal -->
    <div class="modal" id="editCourseModal">
        <div class="modal-content">
            <h3>Edit Course</h3>
            <input type="text" id="editCourseName" placeholder="Course Name">
            <input type="text" id="editCoursePath" placeholder="Course Path" readonly>
            <button class="secondary" onclick="browseEditCourseDirectory()" style="width: 100%; margin-bottom: 15px;">Change Directory</button>
            <div class="buttons">
                <button class="secondary" onclick="closeModal('editCourseModal')">Cancel</button>
                <button class="primary" onclick="saveEditCourse()">Save</button>
            </div>
        </div>
    </div>

    <!-- Edit Specialization Modal -->
    <div class="modal" id="editSpecializationModal">
        <div class="modal-content">
            <h3>Edit Specialization Name</h3>
            <input type="text" id="editSpecializationName" placeholder="Specialization Name">
            <div class="buttons">
                <button class="secondary" onclick="closeModal('editSpecializationModal')">Cancel</button>
                <button class="primary" onclick="saveEditSpecialization()">Save</button>
            </div>
        </div>
    </div>

    <!-- Add Book Modal -->
    <div class="modal" id="addBookModal">
        <div class="modal-content">
            <h3>Add Book</h3>
            <input type="text" id="bookTitle" placeholder="Book Title">
            <input type="text" id="bookPath" placeholder="PDF Path" readonly>
            <button class="secondary" onclick="browseBookFile()" style="width: 100%; margin-bottom: 15px;">Browse PDF File</button>
            <input type="text" id="bookCover" placeholder="Cover Image Path (optional)" readonly>
            <button class="secondary" onclick="browseBookCover()" style="width: 100%; margin-bottom: 15px;">Browse Cover Image</button>
            <label for="bookCategory" style="margin-top:8px; display:block; font-size:13px; color:#ccc;">Category (optional)</label>
            <select id="bookCategory" style="width:100%; padding:8px; margin-bottom:12px; background:#111; color:#e0e0e0; border:1px solid #222;">
                <option value="">No category</option>
            </select>
            <div class="buttons">
                <button class="secondary" onclick="closeModal('addBookModal')">Cancel</button>
                <button class="primary" onclick="addBook()">Add</button>
            </div>
        </div>
        <!-- Fallback hidden file inputs for environments where IPC file selection isn't available -->
        <input type="file" id="bookFileInput" accept="application/pdf" style="display:none" onchange="onBookFileInputChange(event)">
        <input type="file" id="bookCoverInput" accept="image/*" style="display:none" onchange="onBookCoverInputChange(event)">
    </div>

        <!-- Edit Book Modal -->
        <div class="modal" id="editBookModal">
            <div class="modal-content">
                <h3>Edit Book</h3>
                <input type="text" id="editBookTitle" placeholder="Book Title">
                <input type="text" id="editBookPath" placeholder="PDF Path" readonly>
                <button class="secondary" onclick="browseEditBookFile()" style="width: 100%; margin-bottom: 15px;">Change PDF File</button>
                <input type="text" id="editBookCover" placeholder="Cover Image Path (optional)" readonly>
                <button class="secondary" onclick="browseEditBookCover()" style="width: 100%; margin-bottom: 15px;">Change Cover Image</button>
                <label for="editBookCategory" style="margin-top:8px; display:block; font-size:13px; color:#ccc;">Category (optional)</label>
                <select id="editBookCategory" style="width:100%; padding:8px; margin-bottom:12px; background:#111; color:#e0e0e0; border:1px solid #222;">
                    <option value="">No category</option>
                </select>
                <div class="buttons">
                    <button class="secondary" onclick="closeModal('editBookModal')">Cancel</button>
                    <button class="primary" onclick="saveEditBook()">Save</button>
                </div>
            </div>
        </div>

        <!-- Manage Categories Modal -->
        <div class="modal" id="manageCategoriesModal">
            <div class="modal-content">
                <h3>Manage Book Categories</h3>
                <input type="text" id="newCategoryName" placeholder="New category name">
                <div style="margin-top:10px; margin-bottom:10px;">
                    <button class="primary" onclick="addCategory()">Add Category</button>
                </div>
                <div id="categoriesList" style="max-height:200px; overflow:auto; padding-top:8px;"></div>
                <div class="buttons" style="margin-top:12px;">
                    <button class="secondary" onclick="closeModal('manageCategoriesModal')">Close</button>
                </div>
            </div>
        </div>

    <script>
        // Debug: confirm renderer script loaded
        try {
            console.log('[Renderer] index.html script loaded');
            console.log('[Renderer] electronAPI available?', !!window.electronAPI);
        } catch (e) {
            console.error('[Renderer] failed to log startup info', e);
        }
        // Library data
        let library = {
            specializations: [],
            courses: [],
            books: [],
            categories: []
        };

        // Current state
        let currentSpecializationId = null;
        let editingCourseId = null;
        let editingSpecializationId = null;
        let editingBookId = null;
        let currentView = 'welcome';
        let previousView = 'welcome';

        // Player state
        let courses = [];
        let progress = {};
        let currentVideo = null;
        let currentCourse = null;
        let currentModule = null;
        let currentSubtitles = [];
        let selectedSubtitleIndex = -1;
        let autoTranslateEnabled = false;
        let translationCache = new Map(); // Cache for translated subtitles
        let translationPipeline = null;
        let isModelLoaded = false;

        // Load library and progress
        function loadLibrary() {
            const saved = localStorage.getItem('course-library');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Ensure expected shape
                    library = parsed || {};
                    if (!Array.isArray(library.specializations)) library.specializations = [];
                    if (!Array.isArray(library.courses)) library.courses = [];
                    if (!Array.isArray(library.books)) library.books = [];
                    if (!Array.isArray(library.categories)) library.categories = [];
                } catch (e) {
                    console.error('[Library] Failed to parse saved library, resetting to defaults', e);
                    library = { specializations: [], courses: [], books: [], categories: [] };
                }
            }
        }

        function saveLibrary() {
            localStorage.setItem('course-library', JSON.stringify(library));
        }

        function loadProgress() {
            const saved = localStorage.getItem('course-progress');
            if (saved) {
                progress = JSON.parse(saved);
            }
        }

        function saveProgress() {
            localStorage.setItem('course-progress', JSON.stringify(progress));
        }

        // Sidebar state
        let isSidebarVisible = true;

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.getElementById('sidebarToggle');
            isSidebarVisible = !isSidebarVisible;
            
            if (!isSidebarVisible) {
                sidebar.style.transform = 'translateX(-100%)';
                sidebar.style.marginLeft = '-300px';
                toggle.style.left = '0';
                toggle.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                `;
            } else {
                sidebar.style.transform = 'translateX(0)';
                sidebar.style.marginLeft = '0';
                toggle.style.left = '300px';
                toggle.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                `;
            }
        }

        // Initialize
        loadLibrary();
        loadProgress();
        loadApiKey();

        // Always start with the welcome page
        showWelcome();

        // Navigation functions
        function hideAllViews() {
            document.getElementById('welcomePage').classList.remove('active');
            document.getElementById('welcomePage').classList.add('hidden');
            document.getElementById('aboutPage').classList.remove('active');
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('booksLibrary').classList.remove('active');
            document.getElementById('specializationViewer').classList.remove('active');
            document.getElementById('playerView').classList.remove('active');
        }

        function updateHeaderButtons() {
            document.getElementById('homeBtn').style.display = 'inline-block';
            document.getElementById('libraryBtn').style.display = 'inline-block';
            document.getElementById('booksBtn').style.display = 'inline-block';
            document.getElementById('aboutBtn').style.display = 'inline-block';
            
            if (currentView === 'welcome' || currentView === 'dashboard' || currentView === 'books' || currentView === 'about') {
                document.getElementById('backBtn').style.display = 'none';
            } else {
                document.getElementById('backBtn').style.display = 'inline-block';
                document.getElementById('homeBtn').style.display = 'none';
                document.getElementById('libraryBtn').style.display = 'none';
                document.getElementById('booksBtn').style.display = 'none';
                document.getElementById('aboutBtn').style.display = 'none';
            }
        }

        function showWelcome() {
            hideAllViews();
            document.getElementById('welcomePage').classList.add('active');
            document.getElementById('welcomePage').classList.remove('hidden');
            currentView = 'welcome';
            updateHeaderButtons();
        }

        function showAbout() {
            hideAllViews();
            document.getElementById('aboutPage').classList.add('active');
            currentView = 'about';
            updateHeaderButtons();
        }

        function showBooks() {
            hideAllViews();
            document.getElementById('booksLibrary').classList.add('active');
            currentView = 'books';
            updateHeaderButtons();
            renderBooks();
        }

        function goBack() {
            if (currentView === 'specializationViewer') {
                showDashboard();
            } else if (currentView === 'player') {
                if (previousView === 'specializationViewer') {
                    showSpecializationViewer(currentSpecializationId);
                } else {
                    showDashboard();
                }
            }
        }

        // Dashboard functions
        function showDashboard() {
            hideAllViews();
            document.getElementById('dashboard').style.display = 'block';
            currentView = 'dashboard';
            currentSpecializationId = null;
            updateHeaderButtons();
            renderDashboard();
        }

        function showSpecializationViewer(specId) {
            previousView = currentView;
            hideAllViews();
            currentSpecializationId = specId;
            document.getElementById('specializationViewer').classList.add('active');
            currentView = 'specializationViewer';
            updateHeaderButtons();
            renderSpecializationViewer();
        }

        function showPlayerView() {
            previousView = currentView;
            hideAllViews();
            document.getElementById('playerView').classList.add('active');
            currentView = 'player';
            updateHeaderButtons();
        }

        function renderDashboard() {
            renderSpecializations();
            renderCourses();
            updateSpecializationOptions();
        }

        function renderSpecializations() {
            const grid = document.getElementById('specializationsGrid');
            
            if (library.specializations.length === 0) {
                grid.innerHTML = '<p style="color: #666;">No specializations yet. Click "+ Add Specialization" to create one.</p>';
                return;
            }

            grid.innerHTML = '';
            library.specializations.forEach((spec, index) => {
                const coursesInSpec = library.courses.filter(c => c.specializationId === spec.id);
                const card = document.createElement('div');
                card.className = 'specialization-card';
                card.innerHTML = `
                    <h3>${spec.name}</h3>
                    <p class="course-count">${coursesInSpec.length} course${coursesInSpec.length !== 1 ? 's' : ''}</p>
                    <div class="actions">
                        <button class="view" onclick="viewSpecialization('${spec.id}')">View Roadmap</button>
                        <button onclick="openSpecialization('${spec.id}')">Start</button>
                        <button class="delete" onclick="deleteSpecialization('${spec.id}')">Delete</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function renderCourses() {
            const grid = document.getElementById('coursesGrid');
            const individualCourses = library.courses.filter(c => !c.specializationId);
            
            if (individualCourses.length === 0) {
                grid.innerHTML = '<p style="color: #666;">No individual courses yet. Click "+ Add Course" to add one.</p>';
                return;
            }

            grid.innerHTML = '';
            individualCourses.forEach((course, index) => {
                const card = document.createElement('div');
                card.className = 'course-card';
                card.innerHTML = `
                    <h4>${course.name}</h4>
                    <p class="path" title="${course.path}">${course.path}</p>
                    <div class="actions">
                        <button onclick="openCourse('${course.id}')">Open</button>
                        <button class="delete" onclick="deleteCourse('${course.id}')">Delete</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function updateSpecializationOptions() {
            const select = document.getElementById('courseSpecialization');
            select.innerHTML = '<option value="">No Specialization (Individual Course)</option>';
            library.specializations.forEach(spec => {
                select.innerHTML += `<option value="${spec.id}">${spec.name}</option>`;
            });
        }

        // Modal functions
        function showAddSpecializationModal() {
            document.getElementById('specializationName').value = '';
            document.getElementById('addSpecializationModal').classList.add('active');
        }

        function showAddCourseModal() {
            document.getElementById('addCourseModalTitle').textContent = 'Add Course';
            document.getElementById('courseName').value = '';
            document.getElementById('coursePath').value = '';
            document.getElementById('courseSpecialization').value = '';
            document.getElementById('addCourseModal').classList.add('active');
        }

        function showAddCourseToSpecModal() {
            document.getElementById('addCourseModalTitle').textContent = 'Add Course to Specialization';
            document.getElementById('courseName').value = '';
            document.getElementById('coursePath').value = '';
            document.getElementById('courseSpecialization').value = currentSpecializationId;
            document.getElementById('courseSpecialization').disabled = true;
            document.getElementById('addCourseModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.getElementById('courseSpecialization').disabled = false;
        }

        async function browseCourseDirectory() {
            try {
                const path = await window.electronAPI.selectDirectory();
                if (path) {
                    document.getElementById('coursePath').value = path;
                }
            } catch (error) {
                alert(`Error selecting directory: ${error.message}`);
            }
        }

        async function browseEditCourseDirectory() {
            try {
                const path = await window.electronAPI.selectDirectory();
                if (path) {
                    document.getElementById('editCoursePath').value = path;
                }
            } catch (error) {
                alert(`Error selecting directory: ${error.message}`);
            }
        }

        function addSpecialization() {
            const name = document.getElementById('specializationName').value.trim();
            if (!name) {
                alert('Please enter a specialization name');
                return;
            }

            const newSpec = {
                id: Date.now().toString(),
                name: name
            };

            library.specializations.push(newSpec);
            saveLibrary();
            closeModal('addSpecializationModal');
            renderDashboard();
        }

        function addCourse() {
            const name = document.getElementById('courseName').value.trim();
            const path = document.getElementById('coursePath').value.trim();
            const specializationId = document.getElementById('courseSpecialization').value;

            if (!name || !path) {
                alert('Please enter course name and select a directory');
                return;
            }

            const newCourse = {
                id: Date.now().toString(),
                name: name,
                path: path,
                specializationId: specializationId || null,
                order: specializationId ? getNextCourseOrder(specializationId) : 0
            };

            library.courses.push(newCourse);
            saveLibrary();
            closeModal('addCourseModal');
            
            if (currentSpecializationId) {
                renderSpecializationViewer();
            } else {
                renderDashboard();
            }
        }

        function getNextCourseOrder(specId) {
            const courses = library.courses.filter(c => c.specializationId === specId);
            if (courses.length === 0) return 0;
            return Math.max(...courses.map(c => c.order || 0)) + 1;
        }

        function deleteSpecialization(id) {
            if (!confirm('Delete this specialization? Courses will become individual courses.')) {
                return;
            }

            library.specializations = library.specializations.filter(s => s.id !== id);
            library.courses.forEach(c => {
                if (c.specializationId === id) {
                    c.specializationId = null;
                }
            });
            saveLibrary();
            renderDashboard();
        }

        function deleteCourse(id) {
            if (!confirm('Delete this course from library?')) {
                return;
            }

            library.courses = library.courses.filter(c => c.id !== id);
            saveLibrary();
            
            if (currentSpecializationId) {
                renderSpecializationViewer();
            } else {
                renderDashboard();
            }
        }

        function viewSpecialization(specId) {
            showSpecializationViewer(specId);
        }

        function renderSpecializationViewer() {
            const spec = library.specializations.find(s => s.id === currentSpecializationId);
            if (!spec) return;

            document.getElementById('specTitle').textContent = spec.name;

            const coursesInSpec = library.courses
                .filter(c => c.specializationId === currentSpecializationId)
                .sort((a, b) => (a.order || 0) - (b.order || 0));

            const roadmap = document.getElementById('roadmap');

            if (coursesInSpec.length === 0) {
                roadmap.innerHTML = `
                    <div class="empty-roadmap">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                        <h3>No Courses Yet</h3>
                        <p>Add courses to build your learning roadmap</p>
                    </div>
                `;
                return;
            }

            roadmap.innerHTML = '';
            coursesInSpec.forEach((course, index) => {
                const item = document.createElement('div');
                item.className = 'roadmap-item';
                item.innerHTML = `
                    <div class="course-number">${index + 1}</div>
                    <div class="course-content" onclick="openSingleCourse('${course.id}')">
                        <h3>${course.name}</h3>
                        <p class="path">${course.path}</p>
                        <div class="course-actions" onclick="event.stopPropagation()">
                            <button class="start" onclick="openSingleCourse('${course.id}')">Start Course</button>
                            <button class="edit" onclick="editCourse('${course.id}')">Edit</button>
                            <button class="remove" onclick="removeCourseFromSpec('${course.id}')">Remove</button>
                        </div>
                    </div>
                    <div class="order-controls">
                        <button onclick="moveCourseUp('${course.id}')" ${index === 0 ? 'disabled' : ''}>‚ñ≤</button>
                        <button onclick="moveCourseDown('${course.id}')" ${index === coursesInSpec.length - 1 ? 'disabled' : ''}>‚ñº</button>
                    </div>
                `;
                roadmap.appendChild(item);
            });
        }
// Offline translation functions using Transformers.js
async function loadTranslationModel() {
    if (isModelLoaded) return;
    
    try {
        // Import Transformers.js dynamically
        const { pipeline } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0');
        
        // Load translation model (English to Arabic)
        translationPipeline = await pipeline('translation', 'Xenova/nllb-200-distilled-600M', {
            quantized: true,
        });
        
        isModelLoaded = true;
        console.log('Translation model loaded successfully!');
    } catch (error) {
        console.error('Error loading translation model:', error);
        throw error;
    }
}

async function translateSubtitle() {
    const btn = document.getElementById('translateBtn');
    
    // If already translated, restore original
    if (btn.textContent.includes('Original')) {
        window.currentSubtitleContent = window.originalSubtitleContent;
        btn.textContent = 'üåê Translate to Arabic (Offline)';
        return;
    }

    btn.disabled = true;
    btn.textContent = '‚è≥ Loading model...';

    try {
        // Load model if not loaded
        if (!isModelLoaded) {
            await loadTranslationModel();
        }

        btn.textContent = '‚è≥ Translating...';
        
        const subtitles = window.originalSubtitleContent;
        const translatedSubtitles = [];

        // Translate each subtitle
        for (let i = 0; i < subtitles.length; i++) {
            const sub = subtitles[i];
            
            // Translate using the model
            const result = await translationPipeline(sub.text, {
                src_lang: 'eng_Latn',
                tgt_lang: 'arb_Arab'
            });
            
            translatedSubtitles.push({
                start: sub.start,
                end: sub.end,
                text: result[0].translation_text
            });

            // Update progress
            const progress = Math.round(((i + 1) / subtitles.length) * 100);
            btn.textContent = `‚è≥ Translating... ${progress}%`;
        }

        window.currentSubtitleContent = translatedSubtitles;
        btn.textContent = 'üîÑ Show Original';
        btn.disabled = false;
        
        alert('Translation completed successfully!');
    } catch (error) {
        console.error('Translation error:', error);
        alert(`Translation failed: ${error.message}\n\nNote: First load may take time to download the model (~250MB)`);
        btn.textContent = 'üåê Translate to Arabic (Offline)';
        btn.disabled = false;
    }
}

async function changeSubtitle() {
    const select = document.getElementById('subtitleSelect');
    const index = select.value;
    
    if (index === '') {
        selectedSubtitleIndex = -1;
        document.getElementById('subtitleOverlay').classList.remove('visible');
        document.getElementById('translateBtn').style.display = 'none';
        return;
    }
    
    selectedSubtitleIndex = parseInt(index);
    const subtitle = currentSubtitles[selectedSubtitleIndex];
    
    try {
        const content = await window.electronAPI.readSubtitle(subtitle.path);
        window.currentSubtitleContent = parseSRT(content);
        window.originalSubtitleContent = parseSRT(content);
        
        // Show translate button if English subtitle
        if (subtitle.name.toLowerCase().includes('en') || subtitle.name.toLowerCase().includes('english')) {
            document.getElementById('translateBtn').style.display = 'inline-block';
            document.getElementById('translateBtn').textContent = 'üåê Translate to Arabic (Offline)';
            document.getElementById('translateBtn').disabled = false;
        } else {
            document.getElementById('translateBtn').style.display = 'none';
        }
    } catch (error) {
        console.error('Error loading subtitle:', error);
        alert('Error loading subtitle file');
    }
}
        function moveCourseUp(courseId) {
            const coursesInSpec = library.courses
                .filter(c => c.specializationId === currentSpecializationId)
                .sort((a, b) => (a.order || 0) - (b.order || 0));

            const index = coursesInSpec.findIndex(c => c.id === courseId);
            if (index <= 0) return;

            const temp = coursesInSpec[index].order;
            coursesInSpec[index].order = coursesInSpec[index - 1].order;
            coursesInSpec[index - 1].order = temp;

            saveLibrary();
            renderSpecializationViewer();
        }

        function moveCourseDown(courseId) {
            const coursesInSpec = library.courses
                .filter(c => c.specializationId === currentSpecializationId)
                .sort((a, b) => (a.order || 0) - (b.order || 0));

            const index = coursesInSpec.findIndex(c => c.id === courseId);
            if (index >= coursesInSpec.length - 1) return;

            const temp = coursesInSpec[index].order;
            coursesInSpec[index].order = coursesInSpec[index + 1].order;
            coursesInSpec[index + 1].order = temp;

            saveLibrary();
            renderSpecializationViewer();
        }

        function editCourse(courseId) {
            editingCourseId = courseId;
            const course = library.courses.find(c => c.id === courseId);
            if (!course) return;

            document.getElementById('editCourseName').value = course.name;
            document.getElementById('editCoursePath').value = course.path;
            document.getElementById('editCourseModal').classList.add('active');
        }

        function saveEditCourse() {
            const course = library.courses.find(c => c.id === editingCourseId);
            if (!course) return;

            const name = document.getElementById('editCourseName').value.trim();
            const path = document.getElementById('editCoursePath').value.trim();

            if (!name || !path) {
                alert('Please enter course name and path');
                return;
            }

            course.name = name;
            course.path = path;

            saveLibrary();
            closeModal('editCourseModal');
            
            if (currentSpecializationId) {
                renderSpecializationViewer();
            } else {
                renderDashboard();
            }
        }

        function removeCourseFromSpec(courseId) {
            if (!confirm('Remove this course from specialization? It will become an individual course.')) {
                return;
            }

            const course = library.courses.find(c => c.id === courseId);
            if (course) {
                course.specializationId = null;
                course.order = 0;
                saveLibrary();
                renderSpecializationViewer();
            }
        }

        function editSpecialization() {
            editingSpecializationId = currentSpecializationId;
            const spec = library.specializations.find(s => s.id === currentSpecializationId);
            if (!spec) return;

            document.getElementById('editSpecializationName').value = spec.name;
            document.getElementById('editSpecializationModal').classList.add('active');
        }

        function saveEditSpecialization() {
            const spec = library.specializations.find(s => s.id === editingSpecializationId);
            if (!spec) return;

            const name = document.getElementById('editSpecializationName').value.trim();
            if (!name) {
                alert('Please enter a specialization name');
                return;
            }

            spec.name = name;
            saveLibrary();
            closeModal('editSpecializationModal');
            renderSpecializationViewer();
        }

        function startSpecialization() {
            console.log('[startSpecialization] Starting with currentSpecializationId:', currentSpecializationId);
            if (!currentSpecializationId) {
                console.error('[startSpecialization] No specialization ID available');
                alert('Error: No specialization selected');
                return;
            }
            openSpecialization(currentSpecializationId);
        }

        async function openSpecialization(specId) {
            console.log('[openSpecialization] Starting with specId:', specId);
            console.log('[openSpecialization] electronAPI available?', !!window.electronAPI);
            
            const coursesInSpec = library.courses.filter(c => c.specializationId === specId);
            if (coursesInSpec.length === 0) {
                alert('No courses in this specialization');
                return;
            }

            if (!window.electronAPI || !window.electronAPI.scanDirectory) {
                console.error('[openSpecialization] electronAPI or scanDirectory not available');
                alert('Error: Course scanning functionality is not available. Please restart the application.');
                return;
            }

            // Load all courses in specialization
            courses = [];
            let hasErrors = false;
            
            for (const course of coursesInSpec) {
                try {
                    console.log(`[openSpecialization] Scanning course: ${course.name} at path: ${course.path}`);
                    const scannedCourses = await window.electronAPI.scanDirectory(course.path);
                    if (scannedCourses && Array.isArray(scannedCourses)) {
                        courses = courses.concat(scannedCourses);
                        console.log(`[openSpecialization] Successfully scanned ${course.name}, found ${scannedCourses.length} items`);
                    } else {
                        console.error(`[openSpecialization] Invalid scan result for ${course.name}:`, scannedCourses);
                        hasErrors = true;
                    }
                } catch (error) {
                    console.error(`[openSpecialization] Error scanning ${course.name}:`, error);
                    hasErrors = true;
                }
            }

            if (hasErrors) {
                alert('Some courses could not be loaded. Please check the developer console for details.');
            }

            if (courses.length === 0) {
                alert('No valid course content was found. Please verify your course directories.');
                return;
            }

            showPlayerView();
            renderSidebar();
        }

        async function openCourse(courseId) {
            const course = library.courses.find(c => c.id === courseId);
            if (!course) return;

            try {
                courses = await window.electronAPI.scanDirectory(course.path);
                showPlayerView();
                renderSidebar();
            } catch (error) {
                alert(`Error loading course: ${error.message}`);
            }
        }

        async function openSingleCourse(courseId) {
            const course = library.courses.find(c => c.id === courseId);
            if (!course) return;

            try {
                courses = await window.electronAPI.scanDirectory(course.path);
                showPlayerView();
                renderSidebar();
            } catch (error) {
                alert(`Error loading course: ${error.message}`);
            }
        }

        // Books Library Functions
        function renderBooks() {
            const bookshelf = document.getElementById('bookshelf');

            if (!library.books || library.books.length === 0) {
                bookshelf.innerHTML = `
                    <div class="empty-bookshelf">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                        <h3>Your Bookshelf is Empty</h3>
                        <p>Add PDFs to build your digital library</p>
                    </div>
                `;
                return;
            }

            const colors = ['', 'custom-color-1', 'custom-color-2', 'custom-color-3', 'custom-color-4', 'custom-color-5'];
            
            bookshelf.innerHTML = '';
            library.books.forEach((book, index) => {
                const colorClass = book.coverPath ? '' : colors[index % colors.length];
                const bookDiv = document.createElement('div');
                bookDiv.className = 'book';
                
                const coverStyle = book.coverPath ? 
                    `background-image: url('file://${book.coverPath}'); background-size: cover; background-position: center;` : '';
                
                bookDiv.innerHTML = `
                    <div class="book-cover ${colorClass}" onclick="openBook('${book.id}')" style="${coverStyle}">
                        ${!book.coverPath ? `
                            <div class="book-icon">üìö</div>
                            <div class="book-title">${book.title}</div>
                        ` : ''}
                    </div>
                    <div class="book-name" title="${book.title}">${book.title}</div>
                    <div class="book-category" style="color:#9dbbd6; font-size:12px; margin-top:6px;">${book.category ? book.category : ''}</div>
                    <div class="book-actions">
                        <button onclick="openBook('${book.id}')">Read</button>
                        <button onclick="showEditBookModal('${book.id}')">Edit</button>
                        <button class="delete" onclick="deleteBook('${book.id}')">Delete</button>
                    </div>
                `;
                bookshelf.appendChild(bookDiv);
            });
        }

        function showAddBookModal() {
            document.getElementById('bookTitle').value = '';
            document.getElementById('bookPath').value = '';
            document.getElementById('bookCover').value = '';
            // populate categories for selection
            renderBookCategories();
            const cat = document.getElementById('bookCategory');
            if (cat) cat.value = '';
            // reset hidden inputs if present
            const fileInput = document.getElementById('bookFileInput');
            if (fileInput) fileInput.value = null;
            const coverInput = document.getElementById('bookCoverInput');
            if (coverInput) coverInput.value = null;
            console.log('[AddBook] showAddBookModal: inputs cleared, opening modal');
            document.getElementById('addBookModal').classList.add('active');
        }

        async function browseBookFile() {
            console.log('[AddBook] browseBookFile() called');
            // Prefer native file dialog via preload API, fallback to hidden input
            if (window.electronAPI && typeof window.electronAPI.selectFile === 'function') {
                try {
                    console.log('[AddBook] using electronAPI.selectFile for PDF');
                    const path = await window.electronAPI.selectFile({
                        filters: [
                            { name: 'PDF Files', extensions: ['pdf'] }
                        ]
                    });
                    console.log('[AddBook] electronAPI.selectFile returned:', path);
                    if (path) {
                        document.getElementById('bookPath').value = path;
                    }
                    return;
                } catch (error) {
                    console.error('[AddBook] Error selecting file via electronAPI:', error);
                    // fallthrough to input fallback
                }
            }

            // Fallback for environments without IPC: trigger hidden file input
            const input = document.getElementById('bookFileInput');
            console.log('[AddBook] fallback to hidden input available?', !!input);
            if (input) input.click();
        }

        async function browseBookCover() {
            console.log('[AddBook] browseBookCover() called');
            if (window.electronAPI && typeof window.electronAPI.selectFile === 'function') {
                try {
                    console.log('[AddBook] using electronAPI.selectFile for cover image');
                    const path = await window.electronAPI.selectFile({
                        filters: [
                            { name: 'Image Files', extensions: ['jpg', 'jpeg', 'png', 'gif'] }
                        ]
                    });
                    console.log('[AddBook] electronAPI.selectFile (cover) returned:', path);
                    if (path) {
                        document.getElementById('bookCover').value = path;
                    }
                    return;
                } catch (error) {
                    console.error('[AddBook] Error selecting cover via electronAPI:', error);
                }
            }

            const input = document.getElementById('bookCoverInput');
            console.log('[AddBook] fallback to hidden cover input available?', !!input);
            if (input) input.click();
        }

        function onBookFileInputChange(e) {
            const f = e?.target?.files?.[0];
            console.log('[AddBook] onBookFileInputChange file:', f);
            if (f) {
                const val = f.path || f.name || '';
                document.getElementById('bookPath').value = val;
                console.log('[AddBook] set bookPath to', val);
            }
        }

        function onBookCoverInputChange(e) {
            const f = e?.target?.files?.[0];
            console.log('[AddBook] onBookCoverInputChange file:', f);
            if (f) {
                const val = f.path || f.name || '';
                document.getElementById('bookCover').value = val;
                console.log('[AddBook] set bookCover to', val);
            }
        }

        function addBook() {
            const title = document.getElementById('bookTitle').value.trim();
            const path = document.getElementById('bookPath').value.trim();
            const coverPath = document.getElementById('bookCover').value.trim();
            const category = (document.getElementById('bookCategory') && document.getElementById('bookCategory').value) ? document.getElementById('bookCategory').value : null;
            console.log('[AddBook] addBook() called', { title, path, coverPath });

            // Extra debug: check presence of hidden inputs and electronAPI
            console.log('[AddBook] hidden file inputs exist?', {
                bookFileInput: !!document.getElementById('bookFileInput'),
                bookCoverInput: !!document.getElementById('bookCoverInput')
            });
            console.log('[AddBook] electronAPI available?', !!window.electronAPI, 'selectFile?', !!(window.electronAPI && window.electronAPI.selectFile));

            if (!title || !path) {
                alert('Please enter book title and select a PDF file');
                return;
            }

            if (path && !path.toLowerCase().endsWith('.pdf')) {
                alert('Please select a valid PDF file');
                return;
            }

            const newBook = {
                id: Date.now().toString(),
                title: title,
                path: path,
                coverPath: coverPath || null,
                category: category
            };

            // Defensive checks in case library was corrupted/undefined
            if (typeof library !== 'object' || library === null) {
                console.warn('[AddBook] library was undefined or invalid, reinitializing');
                library = { specializations: [], courses: [], books: [], categories: [] };
            }
            if (!Array.isArray(library.books)) {
                console.warn('[AddBook] library.books was not an array, resetting to []');
                library.books = [];
            }
            if (!Array.isArray(library.categories)) {
                console.warn('[AddBook] library.categories was not an array, resetting to []');
                library.categories = [];
            }

            library.books.push(newBook);
            saveLibrary();
            closeModal('addBookModal');
            renderBooks();
        }

        function deleteBook(bookId) {
            if (!confirm('Remove this book from library?')) {
                return;
            }

            library.books = library.books.filter(b => b.id !== bookId);
            saveLibrary();
            renderBooks();
        }

        // Book category and edit helpers
        function renderBookCategories() {
            const select = document.getElementById('bookCategory');
            const editSelect = document.getElementById('editBookCategory');
            if (select) {
                select.innerHTML = '<option value="">No category</option>';
                library.categories.forEach(cat => {
                    select.innerHTML += `<option value="${cat}">${cat}</option>`;
                });
            }
            if (editSelect) {
                editSelect.innerHTML = '<option value="">No category</option>';
                library.categories.forEach(cat => {
                    editSelect.innerHTML += `<option value="${cat}">${cat}</option>`;
                });
            }
        }

        function showManageCategoriesModal() {
            document.getElementById('newCategoryName').value = '';
            renderCategoriesList();
            document.getElementById('manageCategoriesModal').classList.add('active');
        }

        function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            if (!name) return alert('Enter a category name');
            if (!Array.isArray(library.categories)) library.categories = [];
            if (library.categories.includes(name)) return alert('Category already exists');
            library.categories.push(name);
            saveLibrary();
            renderCategoriesList();
            renderBookCategories();
            document.getElementById('newCategoryName').value = '';
        }

        function deleteCategory(name) {
            if (!confirm(`Delete category "${name}"? This will unassign it from all books.`)) return;
            library.categories = library.categories.filter(c => c !== name);
            // Remove category association from books
            library.books.forEach(b => {
                if (b.category === name) b.category = null;
            });
            saveLibrary();
            renderCategoriesList();
            renderBooks();
            renderBookCategories();
        }

        function renderCategoriesList() {
            const container = document.getElementById('categoriesList');
            container.innerHTML = '';
            if (!Array.isArray(library.categories) || library.categories.length === 0) {
                container.innerHTML = '<p style="color:#888">No categories yet.</p>';
                return;
            }
            library.categories.forEach(cat => {
                const row = document.createElement('div');
                row.style.display = 'flex';
                row.style.justifyContent = 'space-between';
                row.style.alignItems = 'center';
                row.style.padding = '6px 0';
                row.innerHTML = `
                    <span style="color:#e0e0e0">${cat}</span>
                    <button class="delete" onclick="deleteCategory('${cat.replace(/'/g,"\\'")}')">Delete</button>
                `;
                container.appendChild(row);
            });
        }

        function showEditBookModal(bookId) {
            const book = library.books.find(b => b.id === bookId);
            if (!book) return alert('Book not found');
            editingBookId = bookId;
            document.getElementById('editBookTitle').value = book.title || '';
            document.getElementById('editBookPath').value = book.path || '';
            document.getElementById('editBookCover').value = book.coverPath || '';
            renderBookCategories();
            const sel = document.getElementById('editBookCategory');
            if (sel) sel.value = book.category || '';
            document.getElementById('editBookModal').classList.add('active');
        }

        async function saveEditBook() {
            if (!editingBookId) return;
            const book = library.books.find(b => b.id === editingBookId);
            if (!book) return alert('Book not found');

            const title = document.getElementById('editBookTitle').value.trim();
            const path = document.getElementById('editBookPath').value.trim();
            const coverPath = document.getElementById('editBookCover').value.trim();
            const category = (document.getElementById('editBookCategory') && document.getElementById('editBookCategory').value) ? document.getElementById('editBookCategory').value : null;

            if (!title || !path) return alert('Please enter book title and select a PDF file');

            book.title = title;
            book.path = path;
            book.coverPath = coverPath || null;
            book.category = category;

            saveLibrary();
            closeModal('editBookModal');
            renderBooks();
        }

        async function browseEditBookFile() {
            if (window.electronAPI && typeof window.electronAPI.selectFile === 'function') {
                try {
                    const path = await window.electronAPI.selectFile({ filters: [{ name: 'PDF Files', extensions: ['pdf'] }] });
                    if (path) document.getElementById('editBookPath').value = path;
                    return;
                } catch (err) {
                    console.error('Error selecting file for edit:', err);
                }
            }
            alert('File picker not available');
        }

        async function browseEditBookCover() {
            if (window.electronAPI && typeof window.electronAPI.selectFile === 'function') {
                try {
                    const path = await window.electronAPI.selectFile({ filters: [{ name: 'Image Files', extensions: ['jpg','jpeg','png','gif'] }] });
                    if (path) document.getElementById('editBookCover').value = path;
                    return;
                } catch (err) {
                    console.error('Error selecting cover for edit:', err);
                }
            }
            alert('File picker not available');
        }

        async function openBook(bookId) {
            const book = library.books.find(b => b.id === bookId);
            if (!book) return;

            try {
                const fileUrl = await window.electronAPI.getFileUrl(book.path);
                
                const playerArea = document.getElementById('playerArea');
                const videoControls = document.getElementById('videoControls');
                
                playerArea.innerHTML = `<iframe id="pdfViewer" src="${fileUrl}"></iframe>`;
                videoControls.style.display = 'none';
                currentVideo = null;
                
                showPlayerView();
            } catch (error) {
                alert(`Error opening book: ${error.message}`);
            }
        }

        // Player functions
        function renderSidebar() {
            const sidebar = document.getElementById('sidebar');
            
            if (courses.length === 0) {
                sidebar.innerHTML = '<div style="text-align: center; color: #666; padding: 40px 20px;"><p>No courses found in the selected directory</p></div>';
                return;
            }

            let html = '';
            courses.forEach((course, courseIdx) => {
                html += `<div class="course-item">
                    <div class="course-header">${course.name}</div>`;
                
                course.modules.forEach((module, moduleIdx) => {
                    const moduleId = `module-${courseIdx}-${moduleIdx}`;
                    html += `
                        <div class="module-item">
                            <div class="module-header" onclick="toggleModule('${moduleId}')">
                                <svg id="${moduleId}-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                                ${module.name}
                            </div>
                            <div class="module-content" id="${moduleId}">`;
                    
                    module.items.forEach((item, itemIdx) => {
                        if (item.type !== 'subtitle') {
                            const itemKey = `${course.name}/${module.name}/${item.name}`;
                            const isComplete = progress[itemKey] || false;
                            const icon = item.type === 'video' 
                                ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>'
                                : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>';
                            
                            html += `
                                <div class="file-item" id="file-${courseIdx}-${moduleIdx}-${itemIdx}" 
                                     onclick="loadFile(${courseIdx}, ${moduleIdx}, ${itemIdx})">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">${icon}</svg>
                                    <span style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${item.name}">${item.name}</span>
                                    <input type="checkbox" class="checkbox" ${isComplete ? 'checked' : ''} 
                                           onclick="event.stopPropagation(); toggleComplete(${courseIdx}, ${moduleIdx}, ${itemIdx})">
                                </div>`;
                        }
                    });
                    
                    html += `</div></div>`;
                });
                
                html += `</div>`;
            });

            sidebar.innerHTML = html;
        }

        function toggleModule(moduleId) {
            const content = document.getElementById(moduleId);
            const icon = document.getElementById(`${moduleId}-icon`);
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>';
            } else {
                content.classList.add('expanded');
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>';
            }
        }

        async function loadFile(courseIdx, moduleIdx, itemIdx) {
            const course = courses[courseIdx];
            const module = course.modules[moduleIdx];
            const item = module.items[itemIdx];

            currentCourse = course;
            currentModule = module;

            document.querySelectorAll('.file-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`file-${courseIdx}-${moduleIdx}-${itemIdx}`).classList.add('active');

            const playerArea = document.getElementById('playerArea');
            const videoControls = document.getElementById('videoControls');
            const currentFileInfo = document.getElementById('currentFileInfo');

            if (item.type === 'video') {
                try {
                    playerArea.innerHTML = '<div class="loading">Loading video...</div><div class="subtitle-overlay" id="subtitleOverlay"></div>';
                    
                    const fileUrl = await window.electronAPI.getFileUrl(item.path);
                    
                    playerArea.innerHTML = `
                        <video id="videoPlayer" controls preload="metadata"></video>
                        <div class="subtitle-overlay" id="subtitleOverlay"></div>
                    `;
                    
                    const video = document.getElementById('videoPlayer');
                    currentVideo = video;
                    
                    video.src = fileUrl;
                    
                    video.addEventListener('timeupdate', updateProgress);
                    video.addEventListener('loadedmetadata', () => {
                        document.getElementById('timeDisplay').textContent = 
                            `${formatTime(0)} / ${formatTime(video.duration)}`;
                    });

                    videoControls.style.display = 'block';
                    currentFileInfo.textContent = `${course.name} > ${module.name} > ${item.name}`;

                    await loadSubtitles(module);

                } catch (error) {
                    playerArea.innerHTML = '<div class="placeholder"><p>Error loading video</p></div>';
                    alert(`Error loading video: ${error.message}`);
                }
            } else if (item.type === 'pdf') {
                try {
                    const fileUrl = await window.electronAPI.getFileUrl(item.path);
                    playerArea.innerHTML = `<iframe id="pdfViewer" src="${fileUrl}"></iframe>`;
                    videoControls.style.display = 'none';
                    currentVideo = null;
                } catch (error) {
                    playerArea.innerHTML = '<div class="placeholder"><p>Error loading PDF</p></div>';
                    alert(`Error loading PDF: ${error.message}`);
                }
            }
        }

        async function loadSubtitles(module) {
            const subtitles = module.items.filter(i => i.type === 'subtitle');
            const subtitleSelect = document.getElementById('subtitleSelect');
            
            currentSubtitles = subtitles;
            selectedSubtitleIndex = -1;
            
            subtitleSelect.innerHTML = '<option value="">None</option>';
            
            if (subtitles.length > 0) {
                subtitles.forEach((sub, idx) => {
                    subtitleSelect.innerHTML += `<option value="${idx}">${sub.name}</option>`;
                });
            }
        }

        async function changeSubtitle() {
            const select = document.getElementById('subtitleSelect');
            const index = select.value;
            
            if (index === '') {
                selectedSubtitleIndex = -1;
                document.getElementById('subtitleOverlay').classList.remove('visible');
                return;
            }
            
            selectedSubtitleIndex = parseInt(index);
            const subtitle = currentSubtitles[selectedSubtitleIndex];
            
            try {
                const content = await window.electronAPI.readSubtitle(subtitle.path);
                window.currentSubtitleContent = parseSRT(content);
            } catch (error) {
                console.error('Error loading subtitle:', error);
                alert('Error loading subtitle file');
            }
        }

        function parseSRT(content) {
            const subtitles = [];
            const blocks = content.trim().split(/\n\s*\n/);
            
            for (const block of blocks) {
                const lines = block.trim().split('\n');
                if (lines.length >= 3) {
                    const timeLine = lines[1];
                    if (timeLine.includes('-->')) {
                        const [start, end] = timeLine.split('-->').map(t => t.trim());
                        const text = lines.slice(2).join('\n');
                        
                        subtitles.push({
                            start: parseTime(start),
                            end: parseTime(end),
                            text: text
                        });
                    }
                }
            }
            
            return subtitles;
        }

        function parseTime(timeStr) {
            timeStr = timeStr.replace(',', '.');
            const parts = timeStr.split(':');
            if (parts.length === 3) {
                const hours = parseFloat(parts[0]);
                const minutes = parseFloat(parts[1]);
                const seconds = parseFloat(parts[2]);
                return hours * 3600 + minutes * 60 + seconds;
            }
            return 0;
        }

        function updateProgress() {
            if (!currentVideo) return;
            
            const percent = (currentVideo.currentTime / currentVideo.duration) * 100;
            document.getElementById('progressBarFill').style.width = `${percent}%`;
            document.getElementById('timeDisplay').textContent = 
                `${formatTime(currentVideo.currentTime)} / ${formatTime(currentVideo.duration)}`;
            
            updateSubtitleDisplay(currentVideo.currentTime);
        }

        async function translateToArabic(text) {
            // First check the cache
            if (translationCache.has(text)) {
                return translationCache.get(text);
            }

            try {
                // Prefer a translation method exposed by the preload (if present).
                if (window.electronAPI && typeof window.electronAPI.translate === 'function') {
                    const translation = await window.electronAPI.translate(text);
                    translationCache.set(text, translation);
                    return translation;
                }

                // Fallback: use the public Google Translate endpoint.
                // This keeps behavior working even when the native module is not available.
                const response = await fetch('https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=ar&dt=t&q=' + encodeURIComponent(text));
                const data = await response.json();
                const translation = (data && data[0] && data[0][0] && data[0][0][0]) ? data[0][0][0] : text;

                // Cache the translation
                translationCache.set(text, translation);

                return translation;
            } catch (error) {
                console.error('Translation error:', error);
                return text; // Return original text if translation fails
            }
        }

        function toggleAutoTranslate() {
            autoTranslateEnabled = document.getElementById('autoTranslateCheck').checked;
            if (selectedSubtitleIndex !== -1) {
                updateSubtitleDisplay(currentVideo.currentTime);
            }
        }

        async function updateSubtitleDisplay(currentTime) {
            if (selectedSubtitleIndex === -1 || !window.currentSubtitleContent) {
                document.getElementById('subtitleOverlay').classList.remove('visible');
                return;
            }
            
            const subtitleOverlay = document.getElementById('subtitleOverlay');
            
            // Find current subtitle
            const currentSubtitle = window.currentSubtitleContent.find(s => 
                currentTime >= s.start && currentTime <= s.end
            );

            if (currentSubtitle) {
                if (autoTranslateEnabled) {
                    const translatedText = await translateToArabic(currentSubtitle.text);
                    subtitleOverlay.innerHTML = `<div class="subtitle-text" dir="rtl">${translatedText}</div>`;
                } else {
                    subtitleOverlay.innerHTML = `<div class="subtitle-text">${currentSubtitle.text}</div>`;
                }
                subtitleOverlay.classList.add('visible');
            } else {
                subtitleOverlay.classList.remove('visible');
            }
            // Note: previous implementation looped again and overwrote the
            // translated text. Above logic already sets the correct text
            // depending on autoTranslateEnabled, so do not overwrite here.
        }

        function toggleComplete(courseIdx, moduleIdx, itemIdx) {
            const course = courses[courseIdx];
            const module = course.modules[moduleIdx];
            const item = module.items[itemIdx];
            const itemKey = `${course.name}/${module.name}/${item.name}`;
            
            progress[itemKey] = !progress[itemKey];
            saveProgress();
        }

        function togglePlay() {
            if (!currentVideo) return;
            
            if (currentVideo.paused) {
                currentVideo.play();
                document.getElementById('playIcon').innerHTML = '<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>';
            } else {
                currentVideo.pause();
                document.getElementById('playIcon').innerHTML = '<path d="M8 5v14l11-7z"/>';
            }
        }

        function seekVideo(event) {
            if (!currentVideo) return;
            
            const bar = document.getElementById('progressBar');
            const rect = bar.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            currentVideo.currentTime = percent * currentVideo.duration;
        }

        function changeSpeed() {
            if (!currentVideo) return;
            const speed = parseFloat(document.getElementById('speedSelect').value);
            currentVideo.playbackRate = speed;
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Translation functions
let translationApiKey = '';

function loadApiKey() {
    const saved = localStorage.getItem('translate-api-key');
    if (saved) {
        translationApiKey = saved;
    }
}

function saveApiKey() {
    const key = document.getElementById('apiKeyInput').value.trim();
    if (!key) {
        alert('Please enter an API key');
        return;
    }
    translationApiKey = key;
    localStorage.setItem('translate-api-key', key);
    closeModal('apiKeyModal');
    alert('API key saved successfully!');
}

async function changeSubtitle() {
    const select = document.getElementById('subtitleSelect');
    const index = select.value;
    
    if (index === '') {
        selectedSubtitleIndex = -1;
        document.getElementById('subtitleOverlay').classList.remove('visible');
        document.getElementById('translateBtn').style.display = 'none';
        return;
    }
    
    selectedSubtitleIndex = parseInt(index);
    const subtitle = currentSubtitles[selectedSubtitleIndex];
    
    try {
        const content = await window.electronAPI.readSubtitle(subtitle.path);
        window.currentSubtitleContent = parseSRT(content);
        window.originalSubtitleContent = parseSRT(content); // Save original
        
        // Show translate button if English subtitle
        if (subtitle.name.toLowerCase().includes('en') || subtitle.name.toLowerCase().includes('english')) {
            document.getElementById('translateBtn').style.display = 'inline-block';
            document.getElementById('translateBtn').textContent = 'üåê Translate to Arabic';
            document.getElementById('translateBtn').disabled = false;
        } else {
            document.getElementById('translateBtn').style.display = 'none';
        }
    } catch (error) {
        console.error('Error loading subtitle:', error);
        alert('Error loading subtitle file');
    }
}

async function translateSubtitle() {
    if (!translationApiKey) {
        document.getElementById('apiKeyInput').value = '';
        document.getElementById('apiKeyModal').classList.add('active');
        return;
    }

    const btn = document.getElementById('translateBtn');
    
    // If already translated, restore original
    if (btn.textContent.includes('Original')) {
        window.currentSubtitleContent = window.originalSubtitleContent;
        btn.textContent = 'üåê Translate to Arabic';
        return;
    }

    btn.disabled = true;
    btn.textContent = '‚è≥ Translating...';

    try {
        const subtitles = window.originalSubtitleContent;
        const translatedSubtitles = [];

        // Translate in batches of 10 to avoid rate limits
        const batchSize = 10;
        for (let i = 0; i < subtitles.length; i += batchSize) {
            const batch = subtitles.slice(i, i + batchSize);
            const texts = batch.map(sub => sub.text);
            
            const translatedTexts = await translateBatch(texts);
            
            batch.forEach((sub, index) => {
                translatedSubtitles.push({
                    start: sub.start,
                    end: sub.end,
                    text: translatedTexts[index]
                });
            });

            // Update progress
            const progress = Math.round(((i + batch.length) / subtitles.length) * 100);
            btn.textContent = `‚è≥ Translating... ${progress}%`;
        }

        window.currentSubtitleContent = translatedSubtitles;
        btn.textContent = 'üîÑ Show Original';
        btn.disabled = false;
        
        alert('Translation completed successfully!');
    } catch (error) {
        console.error('Translation error:', error);
        alert(`Translation failed: ${error.message}`);
        btn.textContent = 'üåê Translate to Arabic';
        btn.disabled = false;
    }
}

async function translateBatch(texts) {
    const url = `https://translation.googleapis.com/language/translate/v2?key=${translationApiKey}`;
    
    const response = await fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            q: texts,
            source: 'en',
            target: 'ar',
            format: 'text'
        })
    });

    if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error?.message || 'Translation failed');
    }

    const data = await response.json();
    return data.data.translations.map(t => t.translatedText);
}

// Initialize API key on load
loadApiKey();
    </script>
    <!-- Translation API Key Modal -->
<div class="modal" id="apiKeyModal">
    <div class="modal-content">
        <h3>Google Translate API Key</h3>
        <p style="color: #888; font-size: 14px; margin-bottom: 15px;">
            Get your free API key from: <a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="color: #3ea6ff;">Google Cloud Console</a>
        </p>
        <input type="password" id="apiKeyInput" placeholder="Enter your Google Translate API Key">
        <div class="buttons">
            <button class="secondary" onclick="closeModal('apiKeyModal')">Cancel</button>
            <button class="primary" onclick="saveApiKey()">Save</button>
        </div>
    </div>
</div>
</body>
</html>